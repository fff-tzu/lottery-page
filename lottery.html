<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>å†¯é¦¨ä»ªçš„æ–°å¹´æŠ½å¥–</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: linear-gradient(135deg, #FAB27B, #ff83c7);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

.container {
  max-width: 1100px;
  width: 100%;
  padding: 20px;
}

h1, h2, h3 {
  text-align: center;
  color: #fff;
}

/* é¢æ¿é‡Œçš„æ ‡é¢˜ï¼šæ·±è‰²æ–‡å­—+å›¾æ ‡å¯¹é½ */
.panel h3 {
  color: #333; /* æ”¹æˆæ·±è‰²ï¼Œå’Œç™½è‰²èƒŒæ™¯åŒºåˆ† */
  margin: 0 0 10px 0; /* å»æ‰é¡¶éƒ¨é—´è·ï¼Œè®©æ ‡é¢˜æ›´é ä¸Š */
  display: flex;
  align-items: center; /* å›¾æ ‡å’Œæ–‡å­—å‚ç›´å±…ä¸­ */
  gap: 8px; /* å›¾æ ‡å’Œæ–‡å­—ä¹‹é—´ç•™å°é—´è· */
}

#loginBox, .panel, .admin {
  background: #fff;
  border-radius: 12px;
  padding: 10px 20px 15px; /* å‡å°‘é¡¶éƒ¨paddingï¼ˆåŸæ¥20pxï¼‰ï¼Œè®©æ ‡é¢˜æ›´é ä¸Š */
  margin-top: 20px;
}

input, button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  border-radius: 8px;
  border: 1px solid #ddd;
  font-size: 16px;
}

button {
  background: #667eea;
  color: #fff;
  border: none;
  cursor: pointer;
}
button:hover { background: #5a6fd8; }

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
  gap: 16px;
  margin-top: 20px;
}

.card {
  height: 160px;
  perspective: 1000px;
}

.card-inner {
  width: 100%;
  height: 100%;
  position: relative;
  transition: transform 0.6s;
  transform-style: preserve-3d;
}

.card.revealed .card-inner {
  transform: rotateY(180deg);
}

.card.revealed {
  animation: glow 1.5s infinite alternate;
}

@keyframes glow {
  from { box-shadow: 0 0 10px gold; }
  to   { box-shadow: 0 0 25px gold; }
}

.card.disabled {
  pointer-events: none;
  filter: grayscale(1) brightness(0.6);
  opacity: 0.5;
}

.face {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: 12px;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* ç»Ÿä¸€å›¾ç‰‡å¤§å° */
.front img, .back img {
  width: 100%;
  height: 100%;
  object-fit: cover; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹å¹¶è¦†ç›–å®¹å™¨ */
}

.back {
  background: #f4f4f4;
  transform: rotateY(180deg);
  flex-direction: column;
  font-size: 14px;
}

/* æŠ½å¥–è®°å½• æ¯æ¡è®°å½•çš„æ ·å¼ */
.log-item {
  border-bottom: 1px solid #eee;
  padding: 5px 0;
  color: #333; /* å­—ä½“é¢œè‰² */
  line-height: 1.5; /* è¡Œé«˜ */
}

#contentArea, #adminArea { display: none; }

/* ç¤¼ç‰©è¯¦æƒ…çš„å¸ƒå±€æ ·å¼ */
.prize-detail {
  display: flex;
  align-items: flex-start;
  gap: 15px; /* å›¾ç‰‡å’Œæ–‡å­—çš„é—´è· */
}
/* ç¼©å°å›¾ç‰‡ï¼ˆå¯è‡ªè¡Œè°ƒæ•´widthæ•°å€¼ï¼‰ */
.prize-img {
  width: 100px; 
  height: auto; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹ */
  border-radius: 8px; /* åœ†è§’æ›´ç¾è§‚ */
}
.prize-name {
  margin: 0;
   /* font-weight: bold;ç¤¼ç‰©åç§°åŠ ç²— */
  font-family: "å¾®è½¯é›…é»‘", sans-serif; /* æ¢å­—ä½“ */
  font-size: 16px; /* å­—ä½“å¤§å° */
  font-weight: 600; /* åŠ ç²—ç¨‹åº¦ */
}
/* è¯¦ç»†è¯´æ˜çš„æ ·å¼ */
.prize-desc {
  margin: 5px 0 0;
  font-family: "å¾®è½¯é›…é»‘", serif; /* è¯¦æƒ…ç”¨ä¸åŒå­—ä½“ */
  font-size: 14px; /* å­—ä½“å¤§å° */
  color: #555; /* æ·±ç°è‰²æ›´æ¸…æ™° */
  line-height: 1.6; /* è¡Œé«˜æ›´å®½æ¾ */
}

/* é€€å‡ºæŒ‰é’®æ ·å¼ */
.logout-btn {
  background: #667eea;
  margin-top: 20px;
}
.logout-btn:hover {
  background: #5a6fd8;
}
</style>
</head>

<body>
<div class="container">
  <h1>å†¯é¦¨ä»ªçš„æ–°å¹´ç¤¼ç‰©ğŸ<br>çœ‹çœ‹ä½ ä¼šé¢†èµ°å“ªä¸ªå§ ğŸ¤—</h1>
  <h2 id="countdown"></h2>

  <!-- ç™»å½• -->
  <div id="loginBox">
    <h3>å¹¸è¿å„¿ç™»å½•</h3>
    <input id="nickInput" placeholder="è¯·è¾“å…¥æ˜µç§°">
    <input id="pwdInput" placeholder="ç®¡ç†å‘˜å¯†ç ï¼ˆå¯é€‰ï¼‰" type="password">
    <button onclick="login()">è¿›å…¥</button>
  </div>

  <!-- å†…å®¹ -->
  <div id="contentArea">
    <div id="userArea">
      <div id="cardGrid" class="grid"></div>

      <div class="panel">
        <h3>ğŸ‘‘ æˆ‘çš„ç¤¼ç‰©</h3>
        <div id="myPrize">æœªæŠ½å¥–</div>
      </div>

      <div class="panel">
        <h3>ğŸ“œ æŠ½å¥–è®°å½•</h3>
        <div id="logList"></div>
      </div>

      <!-- é€€å‡ºæŒ‰é’® -->
      <button id="logoutBtn" class="logout-btn" onclick="logout()" style="display: none;">é€€å‡ºç™»å½•</button>
    </div>

    <div id="adminArea" class="admin">
      <h3>ç®¡ç†å‘˜æ§åˆ¶å°</h3>
      <button onclick="endActivity()">ç»“æŸæ´»åŠ¨</button>
      <button onclick="resetAll()">é‡ç½®æ´»åŠ¨</button>
      <button onclick="exportJSON()">å¯¼å‡º JSON</button>
      <button onclick="exportCSV()">å¯¼å‡º CSV</button>
      <div id="adminLogs"></div>
    </div>
  </div>
</div>

<script>
/* ===== é…ç½®åŒº ===== */
const ADMIN_PWD = "fxy797982";
const CARD_COUNT = 11;
const DURATION = 60 * 60 * 1000;

/* å¡ç‰Œå°é¢ */
const CARD_COVERS = [
  "images/1.png","images/2.png","images/3.png","images/4.png","images/5.png",
  "images/6.jpg","images/7.jpg","images/8.png","images/9.jpg","images/10.png","images/11.jpg"
];

/* âš ï¸ å›ºå®šå¯¹åº”ç¤¼ç‰©ï¼ˆé¡ºåº = å¡ç‰Œé¡ºåºï¼‰ */
const PRIZES = [
  {name:"é™ªçœ‹ææ€–ç”µå½±", img:"images/gift1.png", desc:"åœ¨ä½ æƒ³çœ‹ææ€–ç”µå½±ä½†ä¸æ•¢çœ‹çš„æ—¶å€™ï¼Œæˆ‘å¯ä»¥å…¨ç¨‹é™ªä¼´å“¦"},
  {name:"èŠ’æœä¼šå‘˜", img:"images/gift2.png", desc:"è¶…çº§æ— æ•Œå¤§æƒŠå–œä¹‹èŠ’æœTVä¼šå‘˜å¹´å¡å•¦"},
  {name:"æ‰‹æœºå£³", img:"images/gift3.png", desc:"å›¾ç‰‡åªæ˜¯å‚è€ƒå•¦ï¼Œä½ æƒ³æ¢æ‰‹æœºå£³çš„è¯å¯ä»¥æ‰¾æˆ‘å“¦"},
  {name:"å¿ƒå¹³æ°”å’Œbuff", img:"images/gift4.png", desc:"ä¸‡ä¸€åµæ¶äº†ï¼Œä½ å¯ä»¥è·å¾—24å°æ—¶ä¸ä¼šå¯¹ä½ ç”Ÿæ°”çš„å†¯é¦¨ä»ª"},
  {name:"é›¶é£Ÿ", img:"images/gift5.png", desc:"é›¶é£Ÿ++"},
  {name:"UNOä¸å‘", img:"images/gift6.png", desc:"ç©UNOæ—¶æœ‰ä¸‡èƒ½ç‰Œå°±ä¼šå¸®ä½ å•¦"},
  {name:"é™ªæ‰“éº»å°†", img:"images/gift7.png", desc:"å¦‚æœä½ æƒ³æ‰“éº»å°†ä½†å‡‘ä¸é½äººï¼Œå¯ä»¥æ‰¾æ²¡æœ‰äº‹çš„å†¯é¦¨ä»ª"},
  {name:"æ–°å¹´ç¬¬ä¸€æ¯å¥¶èŒ¶", img:"images/gift8.png", desc:"è¯·ä½ å–æ–°å¹´çš„ç¬¬ä¸€æ¯å¥¶èŒ¶"},
  {name:"ç…§ç‰‡ä¹¦", img:"images/gift9.png", desc:"ç»™ä½ åšå®šåˆ¶çš„ç…§ç‰‡ä¹¦ï¼Œæ‰¿è½½æˆ‘ä»¬çš„å›å¿†"},
  {name:"é¼ æ ‡å«", img:"images/gift10.jpg", desc:"å›¾ç‰‡ä»…ä¾›å‚è€ƒå•¦ï¼Œä½ è¦æ˜¯æƒ³æ¢é¼ æ ‡å«å¯ä»¥æ‰¾æˆ‘å“¦"},
  {name:"NFC", img:"images/gift11.png", desc:"å®šåˆ¶NFCä¸“è¾‘æŒ‚ä»¶ï¼Œå¯ä»¥å½•å…¥ä½ å–œæ¬¢çš„æ­Œæ›²"}
];

/* ===== çŠ¶æ€ ===== */
let state = JSON.parse(localStorage.getItem("lotteryState")) || {
  startedAt: Date.now(),
  isActive: true,
  users: [],
  cards: Array(CARD_COUNT).fill(null),
  logs: []
};

const save = () => localStorage.setItem("lotteryState", JSON.stringify(state));

/* ===== ç™»å½• ===== */
function login(){
  const nick = nickInput.value.trim();
  const pwd = pwdInput.value;
  if(!nick) return alert("è¯·è¾“å…¥æ˜µç§°");

  const role = pwd === ADMIN_PWD ? "admin" : "user";
  // å¦‚æœç”¨æˆ·æ˜¯æ–°ç”¨æˆ·ï¼Œåˆ™æ·»åŠ åˆ° users
  if(!state.users.includes(nick)){
    state.users.push(nick);
    save();
  }
  localStorage.setItem("currentUser", JSON.stringify({nick, role}));
  init();
}

/* ===== é€€å‡ºç™»å½• ===== */
function logout(){
  if(confirm("ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ")){
    localStorage.removeItem("currentUser");
    contentArea.style.display = "none";
    loginBox.style.display = "block";
    nickInput.value = "";
    pwdInput.value = "";
  }
}

/* ===== åˆå§‹åŒ– ===== */
function init(){
  loginBox.style.display = "none";
  contentArea.style.display = "block";
  startCountdown();
  renderCards();
  renderLogs();
  renderMyPrize();

  const user = JSON.parse(localStorage.getItem("currentUser"));
  if(user.role === "admin") {
    adminArea.style.display = "block";
    logoutBtn.style.display = "none";
    renderAdminLogs();
  } else {
    adminArea.style.display = "none";
    logoutBtn.style.display = "block";
    // å¦‚æœç”¨æˆ·å·²æŠ½è¿‡å¥–ï¼Œç¦ç”¨æ‰€æœ‰å¡ç‰Œ
    if(state.cards.some(c => c && c.nick === user.nick)){
      document.querySelectorAll(".card").forEach(card => {
        card.classList.add("disabled");
      });
    }
  }
}

/* ===== å€’è®¡æ—¶ ===== */
function startCountdown(){
  setInterval(()=>{
    if(!state.isActive){
      countdown.innerText = "â° æ´»åŠ¨å·²ç»“æŸ";
      return;
    }
    const remain = DURATION - (Date.now() - state.startedAt);
    if(remain <= 0){
      state.isActive = false;
      save();
    }
    countdown.innerText = `â° å‰©ä½™ ${Math.max(0, Math.floor(remain/60000))} åˆ†`;
  },1000);
}

/* ===== æŠ½å¥–ï¼ˆæ ¸å¿ƒï¼šå›ºå®šå¯¹åº”ï¼‰ ===== */
function drawCard(index){
  const user = JSON.parse(localStorage.getItem("currentUser"));

  if(state.cards.some(c => c && c.nick === user.nick))
    return alert("ä½ å·²ç»æŠ½è¿‡äº†");

  if(state.cards[index])
    return alert("å¾ˆé—æ†¾ï¼Œè¿™å¼ å¡å·²ç»è¢«é¢†èµ°äº†");

  if(!confirm("ç¡®å®šé€‰æ‹©è¿™å¼ å¡ç‰Œå—ï¼Ÿ")) return;

  const prize = PRIZES[index]; // â­ æ ¸å¿ƒï¼šä¸€ä¸€å¯¹åº”

  state.cards[index] = {
    nick: user.nick,
    prize
  };

  state.logs.push({
    nick: user.nick,
    card: index + 1,
    prize: prize.name,
    time: new Date().toLocaleString()
  });

  save();
  renderCards();
  renderLogs();
  renderMyPrize();
}

/* ===== æ¸²æŸ“ ===== */
function renderCards(){
  cardGrid.innerHTML = "";
  const user = JSON.parse(localStorage.getItem("currentUser"));

  state.cards.forEach((c,i)=>{
    const el = document.createElement("div");
    el.className = `card ${c?"revealed":""} ${!state.isActive?"disabled":""}`;
    el.innerHTML = `
      <div class="card-inner">
        <div class="face front"><img src="${CARD_COVERS[i]}"></div>
        <div class="face back">
          ${c ? `<img src="${c.prize.img}"><p>${c.prize.name}</p>${c.nick===user.nick?"ğŸ‘‘ æˆ‘çš„ç¤¼ç‰©":""}` : ""}
        </div>
      </div>`;
    if(!c && state.isActive) el.onclick = () => drawCard(i);
    cardGrid.appendChild(el);
  });
}

function renderMyPrize(){
  const user = JSON.parse(localStorage.getItem("currentUser"));
  const c = state.cards.find(c => c && c.nick === user.nick);
  
  if(c) {
    // æŠ½ä¸­åæ˜¾ç¤ºç¤¼ç‰©è¯¦æƒ…
    myPrize.innerHTML = `
      <div class="prize-detail">
        <img src="${c.prize.img}" class="prize-img">
        <div class="prize-info">
          <p class="prize-name">${c.prize.name}</p>
          <p class="prize-desc">${c.prize.desc}</p>
        </div>
      </div>
    `;
  } else {
    // æ²¡æŠ½å¥–æ—¶æ˜¾ç¤ºæç¤º
    myPrize.innerHTML = "ä½ è¿˜æ²¡æœ‰å¼€å§‹æŠ½å“¦";
  }
}

function renderLogs(){
  logList.innerHTML = "";
  [...state.logs].reverse().forEach(l=>{
    logList.innerHTML += `<div class="log-item">${l.time} - ${l.nick} æŠ½åˆ° ${l.prize}</div>`;
  });
}

function renderAdminLogs(){
  adminLogs.innerHTML = "";
  state.logs.forEach(l=>{
    adminLogs.innerHTML += `<div>${l.nick} | ç¬¬${l.card}å¼  | ${l.prize}</div>`;
  });
}

/* ===== ç®¡ç†å‘˜ ===== */
function endActivity(){ state.isActive = false; save(); }
function resetAll(){ localStorage.clear(); location.reload(); }

function exportJSON(){
  const a = document.createElement("a");
  a.href = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state.logs,null,2));
  a.download = "æŠ½å¥–è®°å½•.json";
  a.click();
}

function exportCSV(){
  let csv = "æ˜µç§°,å¡ç‰Œ,ç¤¼ç‰©,æ—¶é—´\n";
  state.logs.forEach(l=> csv += `${l.nick},${l.card},${l.prize},${l.time}\n`);
  const a = document.createElement("a");
  a.href = "data:text/csv;charset=utf-8," + encodeURIComponent(csv);
  a.download = "æŠ½å¥–è®°å½•.csv";
  a.click();
}

document.addEventListener("DOMContentLoaded",()=>{
  if(localStorage.getItem("currentUser")) init();
});
</script>
</body>
</html>